<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unblocked Games Portal</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for a sleek look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4f46e5; /* Indigo-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* Gray-800 */
        }
        /* Style for the game iframe container */
        #game-player-view {
            width: 100%;
            height: 100vh; /* Full viewport height for immersive play */
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
            background-color: #000;
            display: none; /* Hidden by default */
        }
        #game-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen">

    <!-- Header -->
    <header class="bg-gray-800 shadow-xl p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 id="header-title" class="text-3xl font-extrabold text-indigo-400 tracking-wider">
                Unblocked Portal
            </h1>
        </div>
    </header>

    <!-- Main Content Container for Game List -->
    <main id="game-list-view" class="container mx-auto p-4 sm:p-6 lg:p-8">
        <h2 class="text-2xl font-semibold mb-6 border-b-2 border-indigo-500 pb-2">Available Games</h2>
        
        <!-- Loading Indicator -->
        <div id="loading-indicator" class="text-center py-20">
            <svg class="animate-spin h-10 w-10 text-indigo-400 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="text-lg text-gray-400">Loading game data...</p>
        </div>

        <!-- Game Grid -->
        <div id="games-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
            <!-- Game cards will be injected here by JavaScript -->
        </div>
    </main>

    <!-- Game Player View (Hidden by default, overlays the whole screen) -->
    <div id="game-player-view" class="hidden">
        <div class="p-2 bg-gray-800 flex justify-between items-center">
            <button id="back-button" class="flex items-center space-x-2 px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition duration-200 shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                </svg>
                <span>Back to List</span>
            </button>
            <span id="current-game-title" class="text-xl font-semibold text-white truncate max-w-xs sm:max-w-md"></span>
        </div>
        <iframe id="game-iframe" sandbox="allow-scripts allow-same-origin allow-pointer-lock allow-forms" allowfullscreen></iframe>
    </div>

    <!-- JavaScript Logic -->
    <script>
        const GAME_DATA_URL = 'https://raw.githubusercontent.com/swarmintelli/Unblocked-Games-CDN/main/games.json';
        const gamesGrid = document.getElementById('games-grid');
        const gameListView = document.getElementById('game-list-view');
        const gamePlayerView = document.getElementById('game-player-view');
        const gameIframe = document.getElementById('game-iframe');
        const backButton = document.getElementById('back-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const currentGameTitle = document.getElementById('current-game-title');
        const headerTitle = document.getElementById('header-title');

        let gamesData = [];

        // --- Core Application Logic ---

        /**
         * Fetches game data and initializes the application.
         */
        async function initApp() {
            try {
                const response = await fetch(GAME_DATA_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                gamesData = data;
                renderGameList(gamesData);
                loadingIndicator.classList.add('hidden'); // Hide loading
            } catch (error) {
                console.error('Error fetching game data:', error);
                loadingIndicator.innerHTML = '<p class="text-red-500 text-xl">Failed to load games. Please check the data source URL.</p>';
            }
        }

        /**
         * Renders the grid of game cards.
         * @param {Array<Object>} games - Array of game objects.
         */
        function renderGameList(games) {
            gamesGrid.innerHTML = ''; // Clear existing content
            games.forEach(game => {
                const card = createGameCard(game);
                gamesGrid.appendChild(card);
            });
        }

        /**
         * Creates an HTML card element for a single game.
         * @param {Object} game - Game object from the JSON.
         * @returns {HTMLElement} - The game card element.
         */
        function createGameCard(game) {
            const card = document.createElement('div');
            card.className = 'bg-gray-800 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 transform hover:scale-105 cursor-pointer overflow-hidden';
            card.setAttribute('data-iframe-url', game.iframe);
            card.setAttribute('data-game-title', game.game_name);

            card.innerHTML = `
                <div class="relative w-full h-32 sm:h-40 overflow-hidden">
                    <img src="${game.game_image_icon}" alt="${game.game_name} Thumbnail" 
                         class="w-full h-full object-cover transition-opacity duration-300"
                         onerror="this.onerror=null; this.src='https://placehold.co/400x300/1f2937/9ca3af?text=Image+Not+Found'"
                    >
                </div>
                <div class="p-3">
                    <h3 class="text-md font-bold truncate text-indigo-400">${game.game_name}</h3>
                </div>
            `;

            card.addEventListener('click', () => {
                const iframeUrl = card.getAttribute('data-iframe-url');
                const title = card.getAttribute('data-game-title');
                if (iframeUrl) {
                    playGame(iframeUrl, title);
                } else {
                    console.error('Game URL is missing.');
                }
            });

            return card;
        }

        /**
         * Switches view to the game player and loads the game.
         * @param {string} url - The URL to embed in the iframe.
         * @param {string} title - The title of the game.
         */
        function playGame(url, title) {
            gameIframe.src = url;
            currentGameTitle.textContent = title;
            document.title = `${title} | Unblocked Portal`;
            headerTitle.classList.add('hidden'); // Hide main header
            
            gameListView.classList.add('hidden');
            gamePlayerView.classList.remove('hidden');
            
            // Focus on the iframe for immediate interaction
            gameIframe.focus();
        }

        /**
         * Switches view back to the game list.
         */
        function returnToList() {
            gameIframe.src = 'about:blank'; // Clear the iframe content
            currentGameTitle.textContent = '';
            document.title = 'Unblocked Games Portal';
            headerTitle.classList.remove('hidden'); // Show main header

            gamePlayerView.classList.add('hidden');
            gameListView.classList.remove('hidden');
        }

        // --- Event Listeners ---

        // Handle back button click
        backButton.addEventListener('click', returnToList);

        // Initialize the app when the DOM is ready
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
